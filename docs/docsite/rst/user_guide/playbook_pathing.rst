:orphan:

***********************
Ansible でパスの検索
***********************

絶対パスは常に既知の開始点があるため問題ではありません、相対パス ... は相対的な地点を指しているため、問題になります。

設定パス
============

デフォルトでは、設定パスは設定ファイルに対して相対的である必要があります。一部のファイルは、「cwd」または Playbook に相対的となるため、説明に記載する必要があります。ssh 鍵は、基礎となるツールによりどのように使用されるかをミラーリングするため、「cwd」を使用するように残されます。


タスクパス
==========

ここから複雑になります。検討すべき 2 つのスコープと、タスク評価 (検索のようにパスはすべてローカル)、およびタスクの実行です。これは通常、アクションプラグインが関与している場合はリモートになります。

「ローカル」のリソースが必要な一部のタスクでは、アクションプラグイン (テンプレートおよびコピーが例になります) を使用します。この場合、パスはローカルにもなります。

「ローカル」パスのマジック
--------------------------

検索およびアクションプラグインはどちらも特殊な「検索マジック」を使用します。これには現在のプレイが考慮され、タスクが含まれる Playbook ディレクトリー (これにはロールとインクルードを含む) で、より具体的な指定からより一般的な指定が使用されます。

このマジックを使用して、(相対パスがない場合は) 実行されるアクションに応じて、「files|templates|vars」を追加して最初に相対ファイルが試行されます。デフォルトは「files」、つまり、include_vars は vars/ を使用します。 パスは、指定が具体的なものから一般的なもの (つまりプレイの前にロール) に対して検索されます。
依存しているロールが調べられます (例: タスクが role2 にあり、role2 は role1 の依存関係で、role2 が最初に調べられ、次に role1、次にプレイが参照されます。
つまり、以下のようになります)::

    role search path is rolename/{files|vars|templates}/, rolename/tasks/.
    play search path is playdir/{files|vars|templates}/, playdir/.


現在の作業ディレクトリー (cwd) は検索されません。これを確認すると、たまたま上記のパスのいずれかと一致しています。
ロールからのタスクファイルを `含める` と、ロールの動作がトリガーされません。これは、ロールとして実行された場合にのみ発生します。`include_role` は機能します。
新しい変数 `ansible_search_path` の値には、検索パス (ただし、追加されたサブディレクトリーはなし) が順番に使用されます。5つ の「v」(`-vvvvv`) を使用すると、検索の詳細が表示されます。

インクルードに関しては、最初にインクルードされたファイルのパスを試し、そのファイルを含むプレイまたはロールにフォールバックします。



.. 注記: 「cwd」は、接続プラグインと、アクションがローカルかリモートかによって異なる場合があります。通常、リモートの場合は、ログインシェルがユーザーを配置するディレクトリーになります。ローカルの場合は、ansible を実行したディレクトリーか、場合によっては Playbook ディレクトリーのいずれかになります。
